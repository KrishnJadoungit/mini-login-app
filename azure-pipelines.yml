trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  - group: EC2Secrets   # ğŸ‘ˆ Use your variable group here (created in Library)

jobs:
- job: Deploy
  steps:
    - script: |
        echo "$EC2_SSH_KEY" | base64 -d > ec2-key.pem
        chmod 600 ec2-key.pem
      displayName: "ğŸ” Decode SSH Key"

    - script: |
        ssh -o StrictHostKeyChecking=no -i ec2-key.pem ec2-user@$(EC2_PUBLIC_IP) << 'EOF'
          cd ~/mini-login-app
          git pull origin main
          npm install
          pm2 restart all
        EOF
      displayName: "ğŸš€ Deploy to EC2"
