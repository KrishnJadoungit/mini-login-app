trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  ec2_host: 52.66.86.112
  ec2_user: ec2-user

steps:
- script: |
    echo "$SSH_PRIVATE_KEY" > ec2-key.pem
    chmod 600 ec2-key.pem
    ssh -o StrictHostKeyChecking=no -i ec2-key.pem $(ec2_user)@$(ec2_host) "
      cd ~/mini-login-app &&
      git pull origin main &&
      pm2 restart all
    "
  displayName: 'Deploy to EC2'
